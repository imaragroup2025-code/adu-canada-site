<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ADU Canada | Productized Housing</title>
  <meta name="description" content="Productized, architecturally refined backyard homes delivered through a repeatable system that prioritizes clarity, speed, and budget certainty." />
  <link rel="stylesheet" href="/assets/css/index.css" />
  <script defer data-domain="aducanada.com" src="/assets/analytics/plausible.js"></script>
  <style>
  /* --- TEMP: hide testimonials everywhere --- */
  /* covers common IDs/classes + a text-based fallback */
  section#testimonials,
  .testimonials,
  .testimonial,
  .testimonial-grid,
  .testimonial-card,
  [data-section="testimonials"],
  [data-testid="testimonials"],
  [id*="testimonial" i],
  [class*="testimonial" i] {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    overflow: hidden !important;
  }
</style>
</head>
<script>
(function () {
  const EMAIL = "sales@aducanada.com";

  const mailto = (subject) =>
    `mailto:${EMAIL}?subject=${encodeURIComponent(subject)}`;

  const CTA_RULES = [
    { match: /^contact sales$/i, href: mailto("ADU Canada - Contact Sales") },
    { match: /schedule.*consultation/i, href: mailto("ADU Canada - Schedule a Consultation") },
    { match: /get (your )?price|get price/i, href: mailto("ADU Canada - Get Your Price") },
  ];

  function closestClickable(node) {
    let el = node;
    for (let i = 0; i < 10 && el; i++) {
      const tag = (el.tagName || "").toLowerCase();
      if (tag === "a" || tag === "button") return el;
      if (el.classList && (
          el.classList.contains("btn") ||
          el.classList.contains("btn-primary") ||
          el.classList.contains("btn-secondary")
      )) return el;
      el = el.parentElement;
    }
    return null;
  }

  function normalizeText(s) {
    return (s || "").replace(/\s+/g, " ").trim();
  }

  function applyHrefToAnchors() {
    // If the CTA is already an anchor, force href to mailto
    document.querySelectorAll("a").forEach(a => {
      const t = normalizeText(a.textContent);
      for (const rule of CTA_RULES) {
        if (rule.match.test(t)) a.setAttribute("href", rule.href);
      }
    });
  }

  // CAPTURE-PHASE click override: beats SPA preventDefault/stopPropagation
  document.addEventListener("click", function (e) {
    const el = closestClickable(e.target);
    if (!el) return;

    const text = normalizeText(el.textContent);
    if (!text) return;

    for (const rule of CTA_RULES) {
      if (rule.match.test(text)) {
        e.preventDefault();
        e.stopPropagation();
        if (typeof e.stopImmediatePropagation === "function") e.stopImmediatePropagation();

        // hard navigation triggers mail client reliably
        window.location.href = rule.href;
        return;
      }
    }
  }, true);

  // SPA re-render safety
  applyHrefToAnchors();
  const obs = new MutationObserver(() => applyHrefToAnchors());
  obs.observe(document.documentElement, { childList: true, subtree: true });
})();
</script>  
<body>
  <div id="root"></div>
  <script type="module" src="/assets/js/index.js"></script>
</body>
</html>
